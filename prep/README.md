# Data Preparation

The data is from [cds.climate.copernicus.eu](https://cds.climate.copernicus.eu/).
I'm using a few years of the [ERA5 hourly data on single levels from 1979 to present (cds.climate.copernicus.eu)](https://cds.climate.copernicus.eu/cdsapp#!/dataset/reanalysis-era5-single-levels?tab=overview) dataset.
This dataset is a ECMWF reanalysis which holds hourly data of a lot of variables like wind, pressure, temperature.
Data points were regridded to a regular lat-lon grid of 0.25 degrees.
To reduce the download sizes I only took every 3rd hour (00:00, 03:00, 06:00, ...) and exluded 20째 from the poles (70째S to 70째N).

> last download 23.01.2023

I aggregated data into certain time ranges.
Usually, I am interested in a certain month of a year.
Last year's data would give a very recent reading.
Last 10 year's data would give a more robust reading.
Currently I have:

- each month over year 2022
- each month over years 2018-2022

**Winds**
Winds are given in _u_ and _v_ vectors in m/s where _u_ describes the component blowing eastwards and _v_ describes the component blowing northwards.
The actual directions and velocities have to be calculated from these vectors.
(Note: 180째 addition here because as of convention I want the direction the wind is comming from!)
Then, I used the [Beaufort scale](https://en.wikipedia.org/wiki/Beaufort_scale) for binning wind velocities into 13 bins, and the traditional compass rose bearings (N, NNE, NE, ...) for binning wind directions into 16 bins.
For each time range I counted direction x velocity.

**Temperatures (air)**
Temperatures are given in Kelvin extrapolated to 2 m above earth surface.
(So, I guess this temperature is not very reliable in mountains.)
For each time range I extracted daily high and low temperatures, then calculated high and low means and standard deviations.

**Precipitation**
Total precipitation is given in m (over the grid area if the water would spread evenly).
This includes liquid and frozen water from large-scale and convective precipitation.
"This parameter does not include fog, dew or the precipitation that evaporates in the atmosphere before it lands at the surface of the Earth."
I sum up all precipitation over each day and report daily averages.

**Sea surface temperature**
This is the water temperature near sea surface given in Kelvin.
As with air temperatures I calculated daily high and low means and standard deviations for each time range.

**Wave heights**
This is the average height of the highest third of sea waves that were generated by wind and swell.
It represents the vertical distance in m between wave crest and wave trough.
I used the [Douglas scale](https://en.wikipedia.org/wiki/Douglas_sea_scale) to bin wave heights into 10 bins.
For each time range I counted wave heights.

## Steps to Reproduce

- [s1_download_data.py](./s1_download_data.py) download all necessary grib files
- [s2_collect_values.py](./s2_collect_values.py) collect relevant records from grib files
- [s3_aggregate_data.py](./s3_aggregate_data.py) aggregate data over time ranges
- [s4_upload_objs.py](./s4_upload_objs.py) upload objects to s3 bucket (set API prefix first)
- [s5_check_upload.py](./s5_check_upload.py) to check if everything was uploaded